<!DOCTYPE html>
<html lang="en" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Webmulator Pro + Experimental</title>
    
    <!-- Rom Patcher JS needed CSS/JS files -->
    <link type="text/css" rel="stylesheet" href="./rom-patcher-js/style.css" media="all" />
    <script type="text/javascript" src="./rom-patcher-js/RomPatcher.webapp.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a2e 50%, #0a0a0a 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 20px;
            animation: fadeInDown 0.8s ease;
        }

        .logo {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(45deg, #00f5ff, #ff00ff, #00f5ff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s ease infinite;
            text-shadow: 0 0 30px rgba(0, 245, 255, 0.5);
        }

        .subtitle {
            color: #888;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .badge {
            display: inline-block;
            padding: 5px 15px;
            background: linear-gradient(45deg, #ff00ff, #ff0080);
            border-radius: 20px;
            font-size: 1.2em;
            font-weight: bold;
            margin-left: 10px;
            animation: pulse 2s ease infinite;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }

        .social-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 25px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #00f5ff;
            border-radius: 25px;
            color: #00f5ff;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.3);
        }

        .social-link:hover {
            background: rgba(0, 245, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.6);
            transform: translateY(-2px);
        }

        .main-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.8s ease;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(0, 245, 255, 0.2);
        }

        .tab {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.03);
            border: none;
            color: #888;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 10px 10px 0 0;
            font-size: 1.1em;
            font-weight: 600;
            position: relative;
        }

        .tab:hover {
            color: #00f5ff;
            background: rgba(0, 245, 255, 0.05);
        }

        .tab.active {
            color: #00f5ff;
            background: rgba(0, 245, 255, 0.1);
            border-bottom: 3px solid #00f5ff;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .upload-zone {
            border: 3px dashed rgba(0, 245, 255, 0.3);
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-zone::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 245, 255, 0.1) 0%, transparent 70%);
            animation: pulseGlow 3s ease-in-out infinite;
        }

        .upload-zone:hover {
            border-color: #00f5ff;
            background: rgba(0, 245, 255, 0.05);
            transform: scale(1.02);
        }

        .upload-zone[drag="true"] {
            border-color: #ff00ff;
            background: rgba(255, 0, 255, 0.1);
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        button {
            background: linear-gradient(45deg, #00f5ff, #ff00ff);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 245, 255, 0.4);
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 245, 255, 0.6);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .console-selector, select, input[type="file"] {
            padding: 12px 20px;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(0, 245, 255, 0.5);
            border-radius: 10px;
            color: white;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .console-selector:hover, select:hover {
            border-color: #00f5ff;
            background: rgba(0, 245, 255, 0.1);
        }

        #game {
            width: 100%;
            height: 600px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 245, 255, 0.3);
            margin: 20px 0;
        }

        .info-box {
            background: rgba(0, 245, 255, 0.05);
            border-left: 4px solid #00f5ff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            animation: fadeIn 1s ease;
        }

        .info-box h3 {
            color: #00f5ff;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #ccc;
            line-height: 1.6;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .log-display {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #00f5ff;
            margin: 20px 0;
        }

        .log-entry {
            padding: 5px;
            border-bottom: 1px solid rgba(0, 245, 255, 0.1);
        }

        .timestamp {
            color: #888;
            font-size: 0.85em;
        }

        /* Rom Patcher custom styling */
        #rom-patcher-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 30px;
        }

        .rom-patcher-row {
            margin: 15px 0;
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 20px;
            align-items: center;
        }

        #rom-patcher-button-apply {
            margin-top: 20px;
        }

        .text-right {
            text-align: right;
            color: #00f5ff;
            font-weight: 600;
        }

        .text-muted {
            color: #888;
        }

        details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        summary {
            cursor: pointer;
            color: #00f5ff;
            font-weight: bold;
            padding: 10px;
            transition: all 0.3s ease;
        }

        summary:hover {
            color: #ff00ff;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes pulseGlow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #00f5ff, #ff00ff);
            border-radius: 5px;
        }

        @media (max-width: 768px) {
            .rom-patcher-row {
                grid-template-columns: 1fr;
            }
            .text-right {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="logo">WEBMULATOR PRO <span class="badge">++</span></h1>
            <p class="subtitle">Advanced Retro Gaming Platform with ROM Patching</p>
            <a href="https://instagram.com/12moneyy" target="_blank" class="social-link">
                ðŸ“¸ Follow @12moneyy on Instagram
            </a>
        </div>

        <div class="main-card">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('emulator')">ðŸŽ® Emulator</button>
                <button class="tab" onclick="switchTab('patcher')">ðŸ”§ ROM Patcher</button>
            </div>

            <!-- EMULATOR TAB -->
            <div id="emulatorTab" class="tab-content active">
                <div id="welcomeSection">
                    <div class="upload-zone" id="uploadZone">
                        <div class="upload-icon">ðŸŽ®</div>
                        <h2>Drop ROM File Here</h2>
                        <p style="color: #888; margin: 15px 0;">or</p>
                        <input type="file" id="input" hidden>
                        <button id="uploadbutton">Browse Files</button>
                    </div>

                    <div class="info-box">
                        <h3>What is Webmulator Pro + Experimental?</h3>
                        <p>A cutting-edge retro gaming platform combining emulation and ROM patching. Upload ROM files to play instantly, or use the ROM Patcher to apply translation patches, bug fixes, and modifications. All sessions are tracked and exportable.</p>
                    </div>
                </div>

                <div id="gameSection" style="display: none;">
                    <div id="game"></div>
                    
                    <div class="controls">
                        <button id="downloadLog">ðŸ“¥ Download Activity Log</button>
                        <button id="newGame">ðŸ”„ Load New ROM</button>
                    </div>

                    <div class="info-box">
                        <h3 id="gameTitle">Game Information</h3>
                        <p id="gameInfo">Your gaming session is being tracked. All interactions are logged and can be downloaded.</p>
                    </div>

                    <details>
                        <summary>ðŸ“Š View Activity Log</summary>
                        <div class="log-display" id="logDisplay"></div>
                    </details>
                </div>
            </div>

            <!-- ROM PATCHER TAB -->
            <div id="patcherTab" class="tab-content">
                <div class="info-box">
                    <h3>ðŸ”§ ROM Patcher</h3>
                    <p>Apply patches to your ROM files for translations, bug fixes, and enhancements. Upload your original ROM and select a patch to create a modified version.</p>
                </div>

                <div id="rom-patcher-container">
                    <div class="rom-patcher-row margin-bottom" id="rom-patcher-row-file-rom">
                        <div class="text-right"><label for="rom-patcher-input-file-rom">ROM file:</label></div>
                        <div class="rom-patcher-container-input">
                            <input type="file" id="rom-patcher-input-file-rom" class="empty" disabled />
                        </div>
                    </div>
                    <div class="margin-bottom text-selectable text-mono text-muted" id="rom-patcher-rom-info">
                        <div class="rom-patcher-row">
                            <div class="text-right">CRC32:</div>
                            <div class="text-truncate"><span id="rom-patcher-span-crc32"></span></div>
                        </div>
                        <div class="rom-patcher-row">
                            <div class="text-right">MD5:</div>
                            <div class="text-truncate"><span id="rom-patcher-span-md5"></span></div>
                        </div>
                        <div class="rom-patcher-row">
                            <div class="text-right">SHA-1:</div>
                            <div class="text-truncate"><span id="rom-patcher-span-sha1"></span></div>
                        </div>
                        <div class="rom-patcher-row" id="rom-patcher-row-info-rom">
                            <div class="text-right">ROM:</div>
                            <div class="text-truncate"><span id="rom-patcher-span-rom-info"></span></div>
                        </div>
                    </div>

                    <div class="rom-patcher-row margin-bottom" id="rom-patcher-row-file-patch">
                        <div class="text-right"><label for="rom-patcher-input-file-patch">Patch file:</label></div>
                        <div class="rom-patcher-container-input">
                            <select id="rom-patcher-select-patch"></select>
                        </div>
                    </div>
                    <div class="rom-patcher-row margin-bottom" id="rom-patcher-row-patch-description">
                        <div class="text-right text-mono text-muted">Description:</div>
                        <div class="text-truncate" id="rom-patcher-patch-description"></div>
                    </div>
                    <div class="rom-patcher-row margin-bottom text-selectable text-mono text-muted" id="rom-patcher-row-patch-requirements">
                        <div class="text-right text-mono" id="rom-patcher-patch-requirements-type">ROM requirements:</div>
                        <div class="text-truncate" id="rom-patcher-patch-requirements-value"></div>
                    </div>

                    <div class="text-center" id="rom-patcher-row-apply">
                        <div id="rom-patcher-row-error-message" class="margin-bottom"><span id="rom-patcher-error-message"></span></div>
                        <button id="rom-patcher-button-apply" disabled>Apply patch</button>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px; opacity: 0.5;">
                    <a href="https://github.com/marcrobledo/RomPatcher.js" target="_blank" style="color: #00f5ff; text-decoration: none;">
                        Powered by Rom Patcher JS
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            logActivity('Switched to ' + tabName + ' tab');
        }

        // Activity Logger
        const activityLog = [];
        
        function logActivity(action, details = {}) {
            const entry = {
                timestamp: new Date().toISOString(),
                action: action,
                details: details,
                userAgent: navigator.userAgent,
                screenResolution: `${window.innerWidth}x${window.innerHeight}`
            };
            activityLog.push(entry);
            updateLogDisplay();
        }

        function updateLogDisplay() {
            const logDisplay = document.getElementById('logDisplay');
            if (logDisplay && activityLog.length > 0) {
                const lastEntries = activityLog.slice(-20).reverse();
                logDisplay.innerHTML = lastEntries.map(entry => 
                    `<div class="log-entry">
                        <span class="timestamp">[${new Date(entry.timestamp).toLocaleTimeString()}]</span> 
                        ${entry.action}
                    </div>`
                ).join('');
            }
        }

        // Initialize
        logActivity('Page loaded');

        // Rom Patcher JS initialization
        window.addEventListener('load', function (evt) {
            try {
                RomPatcherWeb.initialize({
                    language: 'en',
                    requireValidation: false
                }, {
                    file: './my_patch.zip',
                    name: 'Game (English v1.0)',
                    description: 'English fan translation for Game',
                    outputName: 'Game (English v1.0)',
                });
                logActivity('ROM Patcher initialized');
            } catch (err) {
                var message = err.message;
                if (/incompatible browser/i.test(message) || /variable RomPatcherWeb/i.test(message))
                    message = 'Your browser is outdated and it is not compatible with ROM Patcher.';

                const container = document.getElementById('rom-patcher-container');
                if (container) {
                    container.innerHTML = '<p style="color: #ff0080; text-align: center; padding: 40px;">' + message + '</p>';
                }
                logActivity('ROM Patcher initialization failed', { error: message });
            }
        });

        // File upload handling
        const input = document.getElementById('input');
        const uploadButton = document.getElementById('uploadbutton');
        const uploadZone = document.getElementById('uploadZone');

        uploadButton.addEventListener('click', () => {
            input.click();
            logActivity('Upload button clicked');
        });

        uploadZone.addEventListener('click', (e) => {
            if (e.target === uploadZone || e.target.classList.contains('upload-icon') || e.target.tagName === 'H2') {
                input.click();
                logActivity('Upload zone clicked');
            }
        });

        // Drag and drop
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.setAttribute('drag', 'true');
            logActivity('File dragged over upload zone');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.removeAttribute('drag');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.removeAttribute('drag');
            if (e.dataTransfer.files.length) {
                input.files = e.dataTransfer.files;
                input.dispatchEvent(new Event('change'));
                logActivity('File dropped', { fileName: e.dataTransfer.files[0].name });
            }
        });

        // ROM loading
        input.onchange = async () => {
            const file = input.files[0];
            const url = URL.createObjectURL(new Blob([file]));
            const parts = file.name.split(".");
            const fileName = parts[0];
            const ext = parts.pop().toLowerCase();

            logActivity('ROM file selected', { fileName: file.name, fileSize: file.size });

            const core = await (async (ext) => {
                if (["fds", "nes", "unif", "unf"].includes(ext)) return "nes";
                if (["smc", "fig", "sfc", "gd3", "gd7", "dx2", "bsx", "swc"].includes(ext)) return "snes";
                if (["z64", "n64"].includes(ext)) return "n64";
                if (["nds", "gba", "gb"].includes(ext)) return ext;

                return await new Promise(resolve => {
                    const cores = {
                        "Nintendo 64": "n64",
                        "Nintendo Game Boy": "gb",
                        "Nintendo Game Boy Advance": "gba",
                        "Nintendo DS": "nds",
                        "Nintendo Entertainment System": "nes",
                        "Super Nintendo Entertainment System": "snes",
                        "PlayStation": "psx",
                        "Virtual Boy": "vb",
                        "Sega Mega Drive": "segaMD",
                        "Sega Master System": "segaMS",
                        "Sega CD": "segaCD",
                        "Atari Lynx": "lynx",
                        "Sega 32X": "sega32x",
                        "Atari Jaguar": "jaguar",
                        "Sega Game Gear": "segaGG",
                        "Sega Saturn": "segaSaturn",
                        "Atari 7800": "atari7800",
                        "Atari 2600": "atari2600"
                    };

                    const modal = document.createElement('div');
                    modal.innerHTML = `
                        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                                    background: rgba(10, 10, 10, 0.95); padding: 40px; border-radius: 20px; 
                                    border: 2px solid #00f5ff; z-index: 1000; text-align: center; box-shadow: 0 0 50px rgba(0, 245, 255, 0.5);">
                            <h2 style="color: #00f5ff; margin-bottom: 20px;">Select Console</h2>
                            <select class="console-selector" id="coreSelect">
                                ${Object.entries(cores).map(([name, value]) => 
                                    `<option value="${value}">${name}</option>`
                                ).join('')}
                            </select>
                            <br><br>
                            <button id="loadBtn">Load Game</button>
                        </div>
                    `;
                    document.body.appendChild(modal);

                    document.getElementById('loadBtn').onclick = () => {
                        const selected = document.getElementById('coreSelect').value;
                        logActivity('Console selected', { console: selected });
                        document.body.removeChild(modal);
                        resolve(selected);
                    };
                });
            })(ext);

            logActivity('Emulator core selected', { core: core });

            // Show game section
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('gameSection').style.display = 'block';
            document.getElementById('gameTitle').textContent = `Now Playing: ${fileName}`;
            document.getElementById('gameInfo').textContent = `Console: ${core.toUpperCase()} | Started: ${new Date().toLocaleString()}`;

            // Initialize emulator
            window.EJS_player = "#game";
            window.EJS_gameName = fileName;
            window.EJS_biosUrl = "";
            window.EJS_gameUrl = url;
            window.EJS_core = core;
            window.EJS_pathtodata = "https://rawcdn.githack.com/EmulatorJS/EmulatorJS/main/data/";
            window.EJS_startOnLoaded = true;

            const script = document.createElement("script");
            script.src = "https://rawcdn.githack.com/EmulatorJS/EmulatorJS/main/data/loader.js";
            script.onload = () => {
                logActivity('Emulator loaded successfully', { game: fileName, core: core });
            };
            document.body.appendChild(script);
        };

        // Download log
        const downloadLogBtn = document.getElementById('downloadLog');
        if (downloadLogBtn) {
            downloadLogBtn.addEventListener('click', () => {
                const logData = {
                    exportDate: new Date().toISOString(),
                    totalActions: activityLog.length,
                    sessionDuration: activityLog.length > 0 ? 
                        (new Date() - new Date(activityLog[0].timestamp)) / 1000 / 60 : 0,
                    activities: activityLog
                };

                const blob = new Blob([JSON.stringify(logData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `webmulator_activity_${Date.now()}.savefile`;
                a.click();
                URL.revokeObjectURL(url);
                
                logActivity('Activity log downloaded');
            });
        }

        // New game
        const newGameBtn = document.getElementById('newGame');
        if (newGameBtn) {
            newGameBtn.addEventListener('click', () => {
                logActivity('New game requested - page reload');
                location.reload();
            });
        }

        // Track mouse movements
        let lastMouseLog = 0;
        document.addEventListener('mousemove', (e) => {
            const now = Date.now();
            if (now - lastMouseLog > 5000) {
                logActivity('Mouse activity', { x: e.clientX, y: e.clientY });
                lastMouseLog = now;
            }
        });

        // Track clicks
        document.addEventListener('click', (e) => {
            logActivity('Click event', { 
                element: e.target.tagName, 
                id: e.target.id || 'none',
                className: e.target.className || 'none',
                position: `${e.clientX},${e.clientY}`
            });
        });

        // Track visibility changes
        document.addEventListener('visibilitychange', () => {
            logActivity(document.hidden ? 'Tab hidden' : 'Tab visible');
        });

        // Track window resize
        window.addEventListener('resize', () => {
            logActivity('Window resized', { 
                dimensions: `${window.innerWidth}x${window.innerHeight}` 
            });
        });

        // Track beforeunload
        window.addEventListener('beforeunload', () => {
            logActivity('User leaving page');
        });

        // Track ROM Patcher interactions
        setTimeout(() => {
            const romInput = document.getElementById('rom-patcher-input-file-rom');
            const applyBtn = document.getElementById('rom-patcher-button-apply');
            
            if (romInput) {
                romInput.addEventListener('change', () => {
                    logActivity('ROM Patcher: ROM file selected', { 
                        fileName: romInput.files[0]?.name 
                    });
                });
            }
            
            if (applyBtn) {
                applyBtn.addEventListener('click', () => {
                    logActivity('ROM Patcher: Apply patch clicked');
                });
            }
        }, 1000);
    </script>
</body>
</html>
